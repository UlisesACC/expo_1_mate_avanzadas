<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tapa de huevo — superficie 3D y curvas de nivel</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/png" href="Line-Graph_41751.ico">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  
  <style>
    /* Estilos adicionales específicos para esta visualización */
    .controls-container {
      background: #fff;
      padding: 20px;
      margin: 20px 0;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      display: flex;
      gap: 20px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .function-info {
      flex: 1;
      min-width: 300px;
    }
    
    .slider-control {
      display: flex;
      gap: 10px;
      align-items: center;
      background: #f8f9fa;
      padding: 10px 15px;
      border-radius: 8px;
      border: 2px solid #e9ecef;
    }
    
    .plots-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin: 20px 0;
    }
    
    .plot {
      width: 100%;
      background: white;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      overflow: hidden;
      transition: transform 0.3s ease;
    }
    
    .plot:hover {
      transform: translateY(-5px);
    }
    
    #plot3d {
      height: 600px;
    }
    
    #contour2d {
      height: 400px;
    }
    
    input[type=range] {
      width: 200px;
      height: 6px;
      border-radius: 3px;
      background: #ddd;
      outline: none;
      -webkit-appearance: none;
    }
    
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #3498db;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    
    input[type=range]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #3498db;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    
    output {
      background: #3498db;
      color: white;
      padding: 5px 10px;
      border-radius: 15px;
      font-weight: bold;
      min-width: 40px;
      text-align: center;
    }
    
    code {
      background: #f8f9fa;
      color: #e74c3c;
      padding: 3px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }
    
    .description {
      color: #6c757d;
      font-size: 0.9em;
      margin-top: 8px;
      font-style: italic;
    }
    
    .instructions {
      background: linear-gradient(120deg, #ffecd2 0%, #fcb69f 100%);
      padding: 15px;
      margin: 20px 0;
      border-radius: 10px;
      border-left: 5px solid #e67e22;
      text-align: center;
      color: #2c3e50;
    }
    
    @media (max-width: 768px) {
      .controls-container {
        flex-direction: column;
        align-items: stretch;
      }
      
      .function-info {
        min-width: auto;
      }
      
      .slider-control {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Superficie "tapa de huevo" y sus curvas de nivel</h1>
    </div>
    <div class="content">
      <div class="controls-container">
        <div class="function-info">
          <label><strong>Función:</strong> <code>f(x,y) = x² + y² + 25(sin²x + sin²y)</code></label>
          <div class="description">
            Mueve el deslizador para cambiar el valor de la <span class="highlight">curva de nivel</span> (z = c).
          </div>
        </div>
        <div class="slider-control">
          <label for="levelRange">Nivel (c):</label>
          <input id="levelRange" type="range" min="0" max="150" step="0.5" value="8">
          <output id="levelVal">8</output>
        </div>
      </div>

      <div class="plots-container">
        <div id="plot3d" class="plot"></div>
        <div id="contour2d" class="plot"></div>
      </div>

      <div class="instructions">
        <strong>Instrucciones:</strong> Arrastra la vista 3D con el ratón. El punto rojo muestra la intersección aproximada entre la superficie y el plano z = c.
      </div>
    </div>
  </div>

  <script>
    // Genera la malla y calcula f(x,y)
    function eggCrate(x,y){
      return x*x + y*y + 25*(Math.sin(x)*Math.sin(x) + Math.sin(y)*Math.sin(y));
    }

    // Crear malla
    const xmin=-6, xmax=6, ymin=-6, ymax=6, step=0.15;
    const xs = [];
    for(let x=xmin; x<=xmax+1e-9; x+=step) xs.push(x);
    const ys = [];
    for(let y=ymin; y<=ymax+1e-9; y+=step) ys.push(y);

    const Z = [];
    for(let i=0;i<ys.length;i++){
      const row=[];
      for(let j=0;j<xs.length;j++){
        row.push(eggCrate(xs[j], ys[i]));
      }
      Z.push(row);
    }

    // Datos para la superficie
    const surface = {
      x: xs,
      y: ys,
      z: Z,
      type: 'surface',
      colorscale: 'Viridis',
      contours: { z: { show: false } },
      opacity: 0.95,
      showscale: true
    };

    // Plano z = c (se actualizará)
    const plane = {
      x: [xmin, xmax, xmax, xmin],
      y: [ymin, ymin, ymax, ymax],
      z: [[0,0,0,0]], // placeholder
      type: 'surface',
      opacity: 0.25,
      colorscale: [[0,'#ff7f0e'],[1,'#ff7f0e']],
      showscale: false,
      hoverinfo:'skip'
    };

    // Puntos de intersección aproximados (scatter3d)
    const inter = {
      x: [], y: [], z: [], mode:'markers', type:'scatter3d', marker:{size:3, color:'red'}, name:'Intersección'
    };

    // Contorno 2D
    const contour2d = {
      x: xs,
      y: ys,
      z: Z,
      type: 'contour',
      contours: { coloring: 'lines' },
      line: { width: 1 }
    };

    // Layout 3D
    const layout3d = {
      margin: {l:0,r:0,b:0,t:30},
      scene: {
        xaxis: {title:'x'}, yaxis:{title:'y'}, zaxis:{title:'z'},
        camera: {eye: {x:1.6, y:1.2, z:0.8}}
      },
      title: 'Superficie 3D: tapa de huevo'
    };

    Plotly.newPlot('plot3d', [surface, plane, inter], layout3d, {responsive:true});
    Plotly.newPlot('contour2d', [contour2d], {margin:{l:40,r:20,t:20,b:40}, title:'Curvas de nivel (proyección)'} , {responsive:true});

    // Función para actualizar plano y puntos de intersección
    function updateLevel(c){
      // actualizar plano z-values (cuadrilátero)
      const planeZ = [[c,c,c,c]];
      const planeUpdate = { z: [planeZ] };

      // calcular puntos aproximados donde |z-c|<eps
      const eps = 0.06; // tolerancia para la "curva" discreta
      const px = [], py = [], pz = [];
      for(let i=0;i<ys.length;i++){
        for(let j=0;j<xs.length;j++){
          const z = Z[i][j];
          if(Math.abs(z - c) <= eps){
            px.push(xs[j]); py.push(ys[i]); pz.push(z);
          }
        }
      }

      // update traces: trace index 1 = plane, index 2 = inter
      Plotly.restyle('plot3d', {z:[planeZ]}, [1]);
      Plotly.restyle('plot3d', {x:[px], y:[py], z:[pz]}, [2]);

      // actualizar el contour 2D para marcar la línea de nivel con colores
      // Plotly cannot easily draw an exact level-line overlay; en su lugar dibujamos un scatter 2D (contorno proyectado)
      const contourXY = {
        x: px,
        y: py,
        mode: 'markers',
        type: 'scatter',
        marker:{size:3,color:'red'},
        name: 'niveles'
      };
      Plotly.react('contour2d', [contour2d, contourXY], {margin:{l:40,r:20,t:20,b:40}, title:'Curvas de nivel (proyección)'} );
    }

    // Inicial
    const slider = document.getElementById('levelRange');
    const levelVal = document.getElementById('levelVal');
    function sync(){
      const c = parseFloat(slider.value);
      levelVal.value = c;
      updateLevel(c);
    }
    slider.addEventListener('input', sync);

    // poner valor inicial cercano a la zona baja
    sync();

    // Resize friendly
    window.addEventListener('resize', ()=>{
      Plotly.Plots.resize(document.getElementById('plot3d'));
      Plotly.Plots.resize(document.getElementById('contour2d'));
    });
  </script>
</body>
</html>
