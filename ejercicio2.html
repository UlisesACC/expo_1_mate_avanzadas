<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programación No Lineal - Ejemplo</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="Line-Graph_41751.ico">
    <script>
    MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
      svg: { fontCache: 'global' }
    };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
    
    <style>
        /* Estilos específicos para este ejemplo */
        .problem-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 5px solid #2c3e50;
            padding: 25px;
            margin: 25px 0;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .lagrange-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-left: 5px solid #f39c12;
            padding: 25px;
            margin: 25px 0;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .conditions-box {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            border-left: 5px solid #17a2b8;
            padding: 25px;
            margin: 25px 0;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .condition-item {
            margin: 15px 0;
            padding: 10px;
            background: rgba(255,255,255,0.6);
            border-radius: 8px;
        }
        
        .section-divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, #3498db, transparent);
            margin: 40px 0;
            border: none;
        }
        
        .solution-box {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-left: 5px solid #28a745;
            padding: 25px;
            margin: 25px 0;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .case-box {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border-left: 5px solid #dc3545;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .result-box {
            background: linear-gradient(135deg, #cce5ff 0%, #b3d9ff 100%);
            border-left: 5px solid #007bff;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .graph-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 5px solid #6c757d;
            padding: 25px;
            margin: 25px 0;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .plot {
            width: 100%;
            height: 580px;
            margin: 15px 0;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            overflow: hidden;
            background: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Programación No Lineal</h1>
        </div>
        <div class="content">
            <div class="problem-box">
                <h2><b>Ejemplo</b></h2>
                <p>
                    <b>Minimizar:</b>
                    $$f(x_1, x_2) = 0.25x_1^2 + x_2^2$$
                </p>
                <p>
                    <b>Sujeto a:</b>
                    $$w(x_1, x_2) = 5 - x_1 - x_2 = 0$$
                    $$g(x_1, x_2) = x_1 + 0.2x_2 - 3 \leq 0$$
                </p>
            </div>

            <hr class="section-divider">

            <div class="lagrange-box">
                <h2><b>Ecuación de Lagrange:</b></h2>
                <p>
                    $$L(x_1, x_2, \lambda, \mu) = f(x_1, x_2) + \lambda w(x_1, x_2) + \mu g(x_1, x_2)$$
                </p>
                <p>
                    $$L(x_1, x_2, \lambda, \mu) = 0.25x_1^2 + x_2^2 + \lambda(5 - x_1 - x_2) + \mu(x_1 + 0.2x_2 - 3)$$
                </p>
            </div>

            <hr class="section-divider">

            <div class="conditions-box">
                <h2><b>Condiciones:</b></h2>
                
                <div class="condition-item">
                    <b>i)</b>
                    $$\frac{\partial L(x_1, x_2, \lambda, \mu)}{\partial x_1} = 0 \Rightarrow 0.5x_1 - \lambda + \mu = 0$$
                    $$\frac{\partial L(x_1, x_2, \lambda, \mu)}{\partial x_2} = 0 \Rightarrow 2x_2 - \lambda + 0.2\mu = 0$$
                </div>

                <div class="condition-item">
                    <b>ii)</b>
                    $$\frac{\partial L(x_1, x_2, \lambda, \mu)}{\partial \lambda} = 0 \Rightarrow 5 - x_1 - x_2 = 0$$
                </div>

                <div class="condition-item">
                    <b>iii)</b>
                    $$g(x_1, x_2) \leq 0 \Rightarrow x_1 + 0.2x_2 - 3 \leq 0$$
                </div>

                <div class="condition-item">
                    <b>iv)</b>
                    $$\mu g(x_1, x_2) = 0 \Rightarrow \mu(x_1 + 0.2x_2 - 3) = 0$$
                    $$\mu \geq 0$$
                </div>
            </div>

            <hr class="section-divider">

            <div class="solution-box">
                <h2><b>Resolución por Casos:</b></h2>
                
                <div class="case-box">
                    <h3><b>Suponiendo que μ = 0, se tiene:</b></h3>
                    <p>
                        $$0.5x_1 - \lambda + \mu = 0 \quad \Rightarrow \quad 0.5x_1 - \lambda = 0$$
                        $$2x_2 - \lambda + 0.2\mu = 0 \quad \Rightarrow \quad 2x_2 - \lambda = 0$$
                        $$5 - x_1 - x_2 = 0 \quad \Rightarrow \quad 5 - x_1 - x_2 = 0$$
                    </p>
                    
                    <div class="result-box">
                        <p><strong>Solución:</strong></p>
                        $$x_1 = 4, \quad x_2 = 1, \quad \lambda = 2$$
                    </div>
                    
                    <p><b>Sin embargo:</b></p>
                    <p>
                        $$iii) \quad g(x_1, x_2) \leq 0 \quad \Rightarrow \quad x_1 + 0.2x_2 - 3 \leq 0$$
                        $$x_1 + 0.2x_2 - 3 = 4 + 0.2 \times 1 - 3 = 1.2 \geq 0, \text{ <span class="highlight">no cumple la condición</span> } (iii)$$
                    </p>
                </div>
                
                <div class="case-box">
                    <h3><b>Suponiendo que μ > 0, entonces g(x₁, x₂) = 0</b></h3>
                    <p>
                        $$x_1 + 0.2x_2 - 3 = 0$$
                        $$5 - x_1 - x_2 = 0$$
                    </p>
                    
                    <div class="result-box">
                        <p><strong>Solución:</strong></p>
                        $$x_1 = 2.5, \quad x_2 = 2.5$$
                    </div>
                    
                    <p><b>Entonces:</b></p>
                    <p>
                        $$0.5x_1 - \lambda + \mu = 0$$
                        $$2x_2 - \lambda + 0.2\mu = 0$$
                    </p>
                    
                    <div class="result-box">
                        <p><strong>Multiplicadores:</strong></p>
                        $$\lambda = 5.9375, \quad \mu = 4.6875$$
                    </div>
                </div>
            </div>

            <hr class="section-divider">

            <div class="graph-box">
                <h2><b>Resultado gráfico</b></h2>
                <p>El resultado gráfico es el siguiente:</p>
                <div id="plot2d" class="plot"></div>

                <p>
                    $$f(x_1, x_2) = 0.25x_1^2 + x_2^2,  f^* = 7.8125$$
                </p>
                <p>
                    \(\nabla f = (0.5x_1,\; 2x_2)\) en \((2.5,2.5) = (1.25,\; 5)\), 
                    \(\nabla w = (-1,\; -1)\), 
                    \(\nabla g = (1,\; 0.2)\).
                </p>
                <p>
                    Verificación KKT en \(x^*=(2.5,2.5)\):
                    $$\nabla f + \lambda\,\nabla w + \mu\,\nabla g = (0,0),\qquad \lambda=5.9375,\; \mu=4.6875.$$
                </p>
            </div>
        </div>
    </div>

    <script>
        // --- Definición de la función objetivo ---
        function f(x1, x2) {
            return 0.25*x1*x1 + x2*x2;
        }

        // Rango y malla
        const xmin = -1, xmax = 6, ymin = -1, ymax = 6, step = 0.1;
        const X = [], Y = [];
        for (let x = xmin; x <= xmax; x += step) X.push(+x.toFixed(2));
        for (let y = ymin; y <= ymax; y += step) Y.push(+y.toFixed(2));

        const Z = [];
        for (let j = 0; j < Y.length; j++) {
            const row = [];
            for (let i = 0; i < X.length; i++) row.push(f(X[i], Y[j]));
            Z.push(row);
        }

        // Curvas de nivel de f (solo líneas, sin relleno)
        const contour = {
            x: X,
            y: Y,
            z: Z,
            type: 'contour',
            contours: { 
                coloring: 'lines',
                showlabels: true, 
                labelfont: { 
                    size: 12, 
                    color: '#2c3e50',
                    family: 'Arial',
                    weight: 'bold'
                },
                start: 0,
                end: 50,
                size: 5
            },
            line: {
                color: '#7f8c8d',
                width: 1.5
            },
            showscale: false,
            name: 'Curvas de nivel f(x₁,x₂)',
            hovertemplate: 'x₁: %{x}<br>x₂: %{y}<br>f: %{z:.2f}<extra></extra>'
        };

        // Restricción w(x)=0: 5 - x1 - x2 = 0  =>  x2 = 5 - x1
        const wLine = { 
            x: [], y: [], 
            mode: 'lines', 
            type: 'scatter', 
            line: { color: '#e74c3c', width: 4, dash: 'solid' }, 
            name: 'w(x)=0: 5-x₁-x₂=0'
        };
        for (let x = xmin; x <= xmax; x += 0.02) { 
            wLine.x.push(x); 
            wLine.y.push(5 - x); 
        }

        // Restricción g(x)=0: x1 + 0.2 x2 - 3 = 0  =>  x2 = (3 - x1)/0.2 = 15 - 5x1
        const gLine = { 
            x: [], y: [], 
            mode: 'lines', 
            type: 'scatter', 
            line: { color: '#2ecc71', width: 4, dash: 'dash' }, 
            name: 'g(x)=0: x₁+0.2x₂-3=0'
        };
        for (let x = xmin; x <= xmax; x += 0.02) { 
            const y2 = 15 - 5*x;
            if (y2 >= ymin && y2 <= ymax) {
                gLine.x.push(x); 
                gLine.y.push(y2);
            }
        }

        // Punto óptimo
        const xStar = 2.5, yStar = 2.5, fStar = f(xStar, yStar);
        const optimum = {
            x: [xStar], y: [yStar], 
            mode: 'markers+text', 
            type: 'scatter',
            text: ['x* = (2.5, 2.5)'], 
            textposition: 'top center',
            textfont: { 
                size: 13, 
                color: '#c0392b', 
                family: 'Arial',
                weight: 'bold'
            },
            marker: { 
                size: 14, 
                color: '#e74c3c', 
                symbol: 'circle', 
                line: { color: '#c0392b', width: 3 } 
            }, 
            name: 'Punto óptimo',
            hovertemplate: `x* = (${xStar}, ${yStar})<br>f* = ${fStar.toFixed(4)}<extra></extra>`
        };

        // Vectores gradiente en el punto óptimo (escalados para visualización)
        const gradF = [0.5*xStar, 2*yStar];     // (1.25, 5)
        const gradW = [-1, -1];                 // (-1, -1)
        const gradG = [1, 0.2];                 // (1, 0.2)
        const s = 0.7; // factor de escala para visualizar

        function arrowTrace(origin, vec, color, name) {
            const endX = origin[0] + s*vec[0];
            const endY = origin[1] + s*vec[1];
            
            // Calcular dirección para la flecha
            const dx = endX - origin[0];
            const dy = endY - origin[1];
            const angle = Math.atan2(dy, dx);
            const arrowSize = 0.15;
            
            // Puntos de la punta de flecha
            const arrowX1 = endX - arrowSize * Math.cos(angle - Math.PI/6);
            const arrowY1 = endY - arrowSize * Math.sin(angle - Math.PI/6);
            const arrowX2 = endX - arrowSize * Math.cos(angle + Math.PI/6);
            const arrowY2 = endY - arrowSize * Math.sin(angle + Math.PI/6);
            
            return {
                x: [origin[0], endX, null, endX, arrowX1, null, endX, arrowX2],
                y: [origin[1], endY, null, endY, arrowY1, null, endY, arrowY2],
                mode: 'lines', 
                type: 'scatter',
                line: { color, width: 3.5 },
                name,
                hovertemplate: `${name} = (${vec[0].toFixed(2)}, ${vec[1].toFixed(2)})<extra></extra>`,
                showlegend: true
            };
        }

        const vfTrace = arrowTrace([xStar, yStar], gradF, '#3498db', '∇f');
        const vwTrace = arrowTrace([xStar, yStar], gradW, '#9b59b6', '∇w');
        const vgTrace = arrowTrace([xStar, yStar], gradG, '#f39c12', '∇g');

        const layout = {
            title: {
                text: 'Curvas de nivel y restricciones',
                font: { size: 20, color: '#2c3e50', family: 'Arial', weight: 'bold' }
            },
            xaxis: { 
                title: { 
                    text: 'x₁',
                    font: { size: 16, color: '#34495e' }
                },
                range: [xmin, xmax], 
                zeroline: true, 
                zerolinecolor: '#bdc3c7',
                zerolinewidth: 2,
                gridcolor: '#ecf0f1',
                showgrid: true,
                gridwidth: 1
            },
            yaxis: { 
                title: { 
                    text: 'x₂',
                    font: { size: 16, color: '#34495e' }
                },
                range: [ymin, ymax], 
                zeroline: true, 
                zerolinecolor: '#bdc3c7',
                zerolinewidth: 2,
                gridcolor: '#ecf0f1',
                showgrid: true,
                gridwidth: 1,
                scaleanchor: 'x',
                scaleratio: 1
            },
            legend: { 
                orientation: 'v', 
                x: 1.02, 
                y: 1,
                xanchor: 'left',
                bgcolor: 'rgba(255,255,255,0.95)',
                bordercolor: '#95a5a6',
                borderwidth: 2,
                font: { size: 12, family: 'Arial' }
            },
            margin: { l: 70, r: 180, t: 70, b: 60 },
            plot_bgcolor: '#ffffff',
            paper_bgcolor: '#f8f9fa',
            hovermode: 'closest'
        };

        const config = {
            displayModeBar: true, 
            responsive: true,
            displaylogo: false,
            modeBarButtonsToRemove: ['select2d', 'lasso2d']
        };

        Plotly.newPlot('plot2d', [contour, wLine, gLine, optimum, vfTrace, vwTrace, vgTrace], layout, config);

        // Redimensionamiento responsivo
        window.addEventListener('resize', () => Plotly.Plots.resize(document.getElementById('plot2d')));
    </script>
</body>
</html>